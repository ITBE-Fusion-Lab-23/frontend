<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>UI Manager Component</title>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .full-screen {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="full-screen" id="container"></div>
    <script type="module">
      import * as OBC from "openbim-components";
      import * as THREE from "three";
      import * as dat from "three/examples/jsm/libs/lil-gui.module.min";

      // basic scene
      const viewerContainer = document.getElementById("container");
      const components = new OBC.Components();
      components.scene = new OBC.SimpleScene(components);
      components.renderer = new OBC.SimpleRenderer(components, viewerContainer);
      components.camera = new OBC.SimpleCamera(components);
      components.raycaster = new OBC.SimpleRaycaster(components);
      components.init();

      components.camera.controls.setLookAt(10, 10, 10, 0, 0, 0);

      const scene = components.scene.get();

      components.scene.setup();

      const grid = new OBC.SimpleGrid(components);

      /* ----- ifc load ----- */
      // fragments
      let fragments = new OBC.FragmentManager(components);
      let fragmentIfcLoader = new OBC.FragmentIfcLoader(components);

      // button
      const mainToolbar = new OBC.Toolbar(components, {
        name: "Main Toolbar",
        position: "bottom",
      });
      components.ui.addToolbar(mainToolbar);
      const ifcButton = fragmentIfcLoader.uiElement.get("main");
      mainToolbar.addChild(ifcButton);

      //WSAM (calibrating the converter)
      await fragmentIfcLoader.setup();

      fragmentIfcLoader.settings.wasm = {
        path: "https://unpkg.com/web-ifc@0.0.46/",
        absolute: true,
      };

      fragmentIfcLoader.settings.webIfc.COORDINATE_TO_ORIGIN = true;
      fragmentIfcLoader.settings.webIfc.OPTIMIZE_PROFILES = true;

      //Load the IFC
      async function loadIfcAsFragments() {
        const filie = await fetch("/GroupA_bridge.ifc");
        const data = await file.arrayBuffer();
        const buffer = new Uint8Array(data);
        const model = await fragementIfcLoader.load(buffer, "example");
        scene.add(model);
      }

      //Delete the IFC
      function disposeFragments() {
        fragments.dispose();
      }
      const setting = {
        disposeFragments: () => disposeFragments(),
      };

      const disposeButton = new OBC.Button(components);
      disposeButton.materialIcon = "delete";
      disposeButton.tooltip = "Delete model";
      mainToolbar.addChild(disposeButton);
      disposeButton.onClick.add(() => disposeFragments());

      //const gui = new dat.GUI();
      //gui.add(setting, "disposeFragments").name("Dispose fragments");
    </script>
  </body>
</html>
